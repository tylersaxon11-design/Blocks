<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HELL'S KITCHEN: Chop & Serve</title>
    <style>
        :root {
            --hk-red: #c41e3a;
            --hk-dark: #111;
            --hk-gold: #d4af37;
            --hk-steel: #8e9eab;
        }

        body {
            background-color: var(--hk-dark);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            user-select: none;
            touch-action: none; /* Prevents scrolling */
        }

        /* --- UI Elements --- */
        #game-container {
            width: 100%;
            height: 100%;
            max-width: 600px;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* --- THE SERVICE PASS (Drop Zone) --- */
        #service-pass {
            height: 120px;
            background: linear-gradient(180deg, #555, #888 20%, #bbb 50%, #888 80%, #555);
            border-bottom: 5px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.8);
            z-index: 10;
        }

        #service-label {
            font-size: 2rem;
            font-weight: 900;
            color: rgba(0,0,0,0.4);
            text-transform: uppercase;
            letter-spacing: 5px;
            pointer-events: none;
        }

        /* Highlight when dragging over */
        .highlight-pass {
            box-shadow: 0 0 30px var(--hk-gold) inset !important;
            border-bottom: 5px solid var(--hk-gold) !important;
        }

        /* --- HUD --- */
        .hud-container {
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--hk-gold);
            text-shadow: 1px 1px 2px black;
            pointer-events: none;
        }

        .bar-container {
            width: 90%;
            margin: 0 auto;
            background: #222;
            height: 15px;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #555;
            margin-bottom: 10px;
        }

        #timer-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff8800, #c41e3a);
            width: 100%;
            transition: width 0.1s linear;
        }

        #instruction-text {
            text-align: center;
            font-size: 1.5rem;
            height: 30px;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            pointer-events: none;
            text-shadow: 0 2px 4px black;
        }

        /* --- THE KITCHEN STATION (Bottom Area) --- */
        #station-area {
            flex-grow: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #2a2a2a; /* Dark floor */
        }

        #cutting-board {
            width: 80%;
            height: 60%;
            background: #5c4033;
            background-image: repeating-linear-gradient(90deg, #5c4033 0, #5c4033 20px, #523a2e 20px, #523a2e 22px);
            border: 8px solid #3e2b22;
            border-radius: 15px;
            position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- The Food Item --- */
        #food-item {
            font-size: 7rem;
            z-index: 100;
            cursor: grab;
            position: absolute; /* Needed for dragging */
            touch-action: none;
            filter: drop-shadow(0 10px 5px rgba(0,0,0,0.5));
            transition: transform 0.1s;
        }

        #food-item.plated {
            filter: drop-shadow(0 15px 15px rgba(0,0,0,0.8));
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Sliced bits flying off */
        .food-slice {
            position: absolute;
            font-size: 4rem;
            pointer-events: none;
            z-index: 50;
            opacity: 1;
        }

        /* Slash effect */
        .slash-effect {
            position: absolute;
            height: 5px;
            background: white;
            width: 150px;
            box-shadow: 0 0 10px white, 0 0 20px var(--hk-red);
            pointer-events: none;
            z-index: 200;
            border-radius: 50%;
            animation: slashAnim 0.15s linear forwards;
        }

        @keyframes slashAnim {
            0% { transform: translate(-50%, -50%) scaleX(0) rotate(var(--angle)); opacity: 1; }
            50% { transform: translate(-50%, -50%) scaleX(1) rotate(var(--angle)); opacity: 1; }
            100% { transform: translate(-50%, -50%) scaleX(1) rotate(var(--angle)); opacity: 0; }
        }

        /* --- Feedback --- */
        #feedback-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            font-weight: 900;
            color: white;
            -webkit-text-stroke: 2px var(--hk-red);
            text-transform: uppercase;
            text-shadow: 4px 4px 0px black;
            opacity: 0;
            pointer-events: none;
            z-index: 500;
            white-space: nowrap;
        }

        /* --- Screens --- */
        #start-screen, #game-over-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        button {
            background: transparent;
            color: white;
            border: 3px solid var(--hk-gold);
            padding: 15px 40px;
            font-size: 1.5rem;
            text-transform: uppercase;
            font-weight: bold;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.2s;
            box-shadow: 0 0 10px var(--hk-gold);
        }

        button:hover {
            background: var(--hk-gold);
            color: black;
            box-shadow: 0 0 30px var(--hk-gold);
        }

        .hidden { display: none !important; }

    </style>
</head>
<body>

    <div id="game-container">
        <!-- The Service Pass (Drop Zone) -->
        <div id="service-pass">
            <div id="service-label">SERVICE PASS</div>
        </div>

        <div class="hud-container">
            <span>DISHES: <span id="score">0</span></span>
            <span><span id="timer-text">45</span>s</span>
        </div>
        
        <div class="bar-container">
            <div id="timer-bar"></div>
        </div>
        
        <div id="instruction-text">PREPARE TO COOK</div>

        <!-- The Station -->
        <div id="station-area">
            <div id="cutting-board">
                <!-- Food Item sits here -->
                <div id="food-item"></div>
            </div>
        </div>

        <div id="feedback-overlay"></div>
    </div>

    <!-- Start Screen -->
    <div id="start-screen">
        <h1 style="color:var(--hk-gold); font-size: 2.5rem; text-transform:uppercase;">Line Cook Simulator</h1>
        <p style="font-size: 1.2rem; margin: 10px 0;">1. TAP to chop ingredients.</p>
        <p style="font-size: 1.2rem; margin: 10px 0;">2. DRAG finished dish to the PASS.</p>
        <button id="start-btn">Start Service</button>
    </div>

    <!-- Game Over Screen -->
    <div id="game-over-screen" class="hidden">
        <h1 id="end-title" style="color:var(--hk-red); font-size: 3rem;">SHUT IT DOWN!</h1>
        <p id="end-reason" style="font-size: 1.5rem;">Disaster.</p>
        <p>Dishes Served: <span id="final-score" style="color:var(--hk-gold)">0</span></p>
        <button id="restart-btn">Restart Service</button>
    </div>

    <script>
        // Config
        const INITIAL_TIME = 45;
        
        // Game State
        let score = 0;
        let timeLeft = INITIAL_TIME;
        let gameInterval;
        let isPlaying = false;
        
        // Item State
        let currentItem = {};
        let cutsRemaining = 0;
        let maxCuts = 0;
        let isReadyToServe = false;

        // Dragging State
        let isDragging = false;
        let dragOffsetX = 0;
        let dragOffsetY = 0;

        // Assets
        // raw: ingredient emoji, plated: finished dish emoji
        const recipes = [
            { raw: 'ðŸ…', plated: 'ðŸ', name: 'Pasta', cuts: 5 },
            { raw: 'ðŸ¥©', plated: 'ðŸ¥˜', name: 'Beef Welly', cuts: 8 },
            { raw: 'ðŸ”', plated: 'ðŸ—', name: 'Chicken', cuts: 6 },
            { raw: 'ðŸŸ', plated: 'ðŸ£', name: 'Salmon', cuts: 7 },
            { raw: 'ðŸ¥¬', plated: 'ðŸ¥—', name: 'Salad', cuts: 4 },
            { raw: 'ðŸ¥”', plated: 'ðŸŸ', name: 'Fries', cuts: 5 },
            { raw: 'ðŸ„', plated: 'ðŸ¥£', name: 'Risotto', cuts: 6 }
        ];

        const insults = [
            "WAKE UP!",
            "GET OUT!",
            "IT'S RAW!",
            "YOU DONKEY!",
            "PATHETIC!",
            "TOUCH THE FISH!",
            "WHERE'S THE LAMB SAUCE?!"
        ];

        const praises = [
            "SERVICE!",
            "AWAY.",
            "GO.",
            "NICE.",
            "BEAUTIFUL."
        ];

        // Elements
        const elContainer = document.getElementById('game-container');
        const elPass = document.getElementById('service-pass');
        const elBoard = document.getElementById('cutting-board');
        const elFood = document.getElementById('food-item');
        const elScore = document.getElementById('score');
        const elTimerText = document.getElementById('timer-text');
        const elTimerBar = document.getElementById('timer-bar');
        const elInstruct = document.getElementById('instruction-text');
        const elFeedback = document.getElementById('feedback-overlay');
        const elStartScreen = document.getElementById('start-screen');
        const elGameOverScreen = document.getElementById('game-over-screen');

        // --- BUTTONS ---
        document.getElementById('start-btn').addEventListener('click', startGame);
        document.getElementById('restart-btn').addEventListener('click', startGame);

        // --- INPUT HANDLERS (Unified Pointer Events) ---
        
        // 1. POINTER DOWN (Start Chop OR Start Drag)
        document.addEventListener('pointerdown', (e) => {
            if (!isPlaying) return;
            if (e.target.tagName === 'BUTTON') return;

            // Check if we are clicking on the food AND it is ready to serve
            if (isReadyToServe && e.target.id === 'food-item') {
                startDrag(e);
            } 
            // Otherwise, if it's NOT ready to serve, we chop
            else if (!isReadyToServe) {
                handleChop(e.clientX, e.clientY);
            }
        });

        // 2. POINTER MOVE (Drag Logic)
        document.addEventListener('pointermove', (e) => {
            if (isDragging) {
                e.preventDefault(); // Stop scrolling
                const x = e.clientX - dragOffsetX;
                const y = e.clientY - dragOffsetY;
                elFood.style.left = `${x}px`;
                elFood.style.top = `${y}px`;
                
                checkPassHover(e.clientX, e.clientY);
            }
        });

        // 3. POINTER UP (End Drag / Check Drop)
        document.addEventListener('pointerup', (e) => {
            if (isDragging) {
                stopDrag(e);
            }
        });


        // --- GAME LOOP ---

        function startGame() {
            score = 0;
            timeLeft = INITIAL_TIME;
            isPlaying = true;
            isDragging = false;
            
            elScore.innerText = 0;
            elStartScreen.classList.add('hidden');
            elGameOverScreen.classList.add('hidden');
            elTimerBar.style.background = "linear-gradient(90deg, #ff8800, #c41e3a)";

            clearInterval(gameInterval);
            gameInterval = setInterval(gameLoop, 100);
            
            nextItem();
        }

        function gameLoop() {
            if (!isPlaying) return;
            
            timeLeft -= 0.1;
            elTimerText.innerText = Math.ceil(timeLeft);
            
            let percent = (timeLeft / INITIAL_TIME) * 100;
            elTimerBar.style.width = percent + "%";
            
            if (timeLeft < 10) elTimerBar.style.background = "#c41e3a";
            
            if (timeLeft <= 0) {
                gameOver();
            }
        }

        function nextItem() {
            // Remove old slices
            document.querySelectorAll('.food-slice').forEach(el => el.remove());

            const recipe = recipes[Math.floor(Math.random() * recipes.length)];
            const difficulty = Math.floor(score / 5);
            
            currentItem = { ...recipe };
            maxCuts = currentItem.cuts + difficulty;
            cutsRemaining = maxCuts;
            isReadyToServe = false;

            // Reset Food Position to Center of Board
            elFood.style.position = 'absolute';
            elFood.style.transform = 'translate(-50%, -50%) scale(1)';
            elFood.style.left = '50%';
            elFood.style.top = '50%';
            
            // Set Visuals
            elFood.innerText = currentItem.raw;
            elFood.className = ''; // remove plated class
            elFood.style.opacity = '1';
            
            updateInstruction();
        }

        function updateInstruction() {
            if (isReadyToServe) {
                elInstruct.innerText = `SERVE THE ${currentItem.name}!`;
                elInstruct.style.color = "var(--hk-gold)";
            } else {
                elInstruct.innerText = `CHOP: ${cutsRemaining}`;
                elInstruct.style.color = "white";
            }
        }

        // --- MECHANICS ---

        function handleChop(x, y) {
            if (cutsRemaining <= 0) return;

            cutsRemaining--;
            
            // Visuals
            createSlash(x, y);
            createSlicePiece();
            
            // Shrink effect
            const scale = 0.5 + ((cutsRemaining / maxCuts) * 0.5);
            elFood.style.transform = `translate(-50%, -50%) scale(${scale})`;

            if (cutsRemaining <= 0) {
                prepareForService();
            } else {
                updateInstruction();
            }
        }

        function prepareForService() {
            isReadyToServe = true;
            
            // Transform Visuals
            elFood.innerText = currentItem.plated;
            elFood.classList.add('plated');
            elFood.style.transform = 'translate(-50%, -50%) scale(1)'; // Reset size
            
            updateInstruction();
        }

        // --- DRAG AND DROP ---

        function startDrag(e) {
            isDragging = true;
            
            // Calculate offset so element doesn't jump to mouse center
            const rect = elFood.getBoundingClientRect();
            dragOffsetX = e.clientX - rect.left;
            dragOffsetY = e.clientY - rect.top;

            // Determine current left/top styles (converting to pixels for smooth drag)
            elFood.style.position = 'fixed'; // Switch to fixed for easier global dragging
            elFood.style.left = rect.left + 'px';
            elFood.style.top = rect.top + 'px';
            elFood.style.transform = 'scale(1.2)'; // Pickup effect
            elFood.style.zIndex = 1000;
        }

        function checkPassHover(x, y) {
            const passRect = elPass.getBoundingClientRect();
            // Check if cursor is inside the Pass box
            if (x >= passRect.left && x <= passRect.right &&
                y >= passRect.top && y <= passRect.bottom) {
                elPass.classList.add('highlight-pass');
            } else {
                elPass.classList.remove('highlight-pass');
            }
        }

        function stopDrag(e) {
            isDragging = false;
            elPass.classList.remove('highlight-pass');
            elFood.style.transform = 'scale(1)';

            const passRect = elPass.getBoundingClientRect();
            const foodRect = elFood.getBoundingClientRect();

            // Simple collision: checks if center of food is roughly inside the pass area
            const foodCenterX = foodRect.left + foodRect.width/2;
            const foodCenterY = foodRect.top + foodRect.height/2;

            if (foodCenterY < passRect.bottom && foodCenterY > passRect.top) {
                // Success!
                dishServed();
            } else {
                // Fail: Snap back to board
                elFood.style.transition = 'all 0.2s ease-out';
                // Need to put it back relative to board, but simple way is just re-running nextItem visual reset logic slightly different
                // Actually, just append it back to board container and center it
                elFood.style.position = 'absolute';
                elFood.style.left = '50%';
                elFood.style.top = '50%';
                elFood.style.transform = 'translate(-50%, -50%)';
                
                // Clear transition after it lands
                setTimeout(() => { elFood.style.transition = ''; }, 200);
            }
        }

        function dishServed() {
            score++;
            elScore.innerText = score;
            timeLeft = Math.min(timeLeft + 5, 60); // Bonus time
            
            showFeedback(true);
            
            // Hide food momentarily
            elFood.style.opacity = '0';
            
            setTimeout(nextItem, 300);
        }

        // --- FX ---

        function createSlash(x, y) {
            const slash = document.createElement('div');
            slash.className = 'slash-effect';
            slash.style.left = x + 'px';
            slash.style.top = y + 'px';
            const angle = Math.floor(Math.random() * 180);
            slash.style.setProperty('--angle', angle + 'deg');
            document.body.appendChild(slash);
            setTimeout(() => slash.remove(), 200);
        }

        function createSlicePiece() {
            const slice = document.createElement('div');
            slice.className = 'food-slice';
            slice.innerText = currentItem.raw;
            slice.style.left = '50%';
            slice.style.top = '50%';
            slice.style.transform = 'translate(-50%, -50%)';
            elBoard.appendChild(slice); // relative to board

            void slice.offsetWidth; // reflow

            const moveX = (Math.random() - 0.5) * 300;
            const moveY = (Math.random() - 0.5) * 300;
            const rot = Math.random() * 360;

            slice.style.transition = "transform 0.4s ease-out";
            slice.style.transform = `translate(-50%, -50%) translate(${moveX}px, ${moveY}px) rotate(${rot}deg) scale(0.6, 0.2)`;
        }

        function showFeedback(isGood) {
            const text = isGood 
                ? praises[Math.floor(Math.random() * praises.length)]
                : insults[Math.floor(Math.random() * insults.length)];
            
            elFeedback.innerText = text;
            elFeedback.style.color = isGood ? "var(--hk-gold)" : "var(--hk-red)";
            elFeedback.style.opacity = "1";
            elFeedback.style.transform = "translate(-50%, -50%) scale(1.5)";
            elFeedback.style.transition = "all 0.1s ease-out";

            setTimeout(() => {
                elFeedback.style.opacity = "0";
                elFeedback.style.transform = "translate(-50%, -50%) scale(1)";
                elFeedback.style.transition = "all 0.5s ease-in";
            }, 500);
        }

        function gameOver() {
            isPlaying = false;
            clearInterval(gameInterval);
            const text = insults[Math.floor(Math.random() * insults.length)];
            document.getElementById('end-title').innerText = text;
            document.getElementById('final-score').innerText = score;
            elGameOverScreen.classList.remove('hidden');
        }

    </script>
</body>
</html>
